<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Wizard of Destiny Tales - Interactive Tarot</title>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Sarabun', sans-serif;
            background: linear-gradient(135deg, #0a0e27 0%, #1a1f3a 50%, #2d1b4e 100%);
            color: #fff;
            min-height: 100vh;
        }

        .magic-bg {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: radial-gradient(2px 2px at 20% 30%, white, transparent),
                        radial-gradient(2px 2px at 60% 70%, white, transparent),
                        radial-gradient(1px 1px at 50% 50%, white, transparent);
            background-size: 200% 200%;
            animation: sparkle 8s ease-in-out infinite;
            opacity: 0.3;
            pointer-events: none;
            z-index: 0;
        }

        @keyframes sparkle {
            0%, 100% { background-position: 0% 0%; }
            50% { background-position: 100% 100%; }
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
            z-index: 1;
        }

        header {
            text-align: center;
            padding: 40px 20px;
        }

        .logo {
            font-size: 48px;
            margin-bottom: 10px;
        }

        h1 {
            font-size: 36px;
            background: linear-gradient(135deg, #9b59b6, #e74c3c, #f39c12);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }

        .tagline {
            color: #c9b3d4;
            font-size: 18px;
            font-style: italic;
        }

        /* Step Progress */
        .progress {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin: 30px 0;
        }

        .progress-step {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: rgba(155, 89, 182, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            border: 2px solid rgba(155, 89, 182, 0.3);
        }

        .progress-step.active {
            background: linear-gradient(135deg, #9b59b6, #8e44ad);
            border-color: #9b59b6;
            box-shadow: 0 0 20px rgba(155, 89, 182, 0.6);
        }

        /* Screens */
        .screen {
            display: none;
            animation: fadeIn 0.5s;
        }

        .screen.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Topic Selection */
        .topics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .topic-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 2px solid rgba(155, 89, 182, 0.3);
            border-radius: 15px;
            padding: 30px 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .topic-card:hover {
            transform: translateY(-5px);
            border-color: #9b59b6;
            box-shadow: 0 10px 30px rgba(155, 89, 182, 0.4);
        }

        .topic-icon {
            font-size: 50px;
            margin-bottom: 15px;
        }

        .topic-title {
            font-size: 22px;
            color: #9b59b6;
            margin-bottom: 8px;
        }

        /* Question Input */
        .question-section {
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(155, 89, 182, 0.3);
            border-radius: 15px;
            padding: 40px 30px;
            margin: 30px 0;
        }

        .question-input {
            width: 100%;
            padding: 15px;
            border: 2px solid rgba(155, 89, 182, 0.3);
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
            font-size: 18px;
            font-family: 'Sarabun', sans-serif;
            margin-bottom: 20px;
        }

        .question-input:focus {
            outline: none;
            border-color: #9b59b6;
        }

        .suggestions {
            display: grid;
            gap: 10px;
        }

        .suggestion-btn {
            background: rgba(155, 89, 182, 0.2);
            border: 1px solid rgba(155, 89, 182, 0.4);
            color: #c9b3d4;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            text-align: left;
            transition: all 0.3s;
        }

        .suggestion-btn:hover {
            background: rgba(155, 89, 182, 0.4);
            color: #fff;
        }

        /* Package Selection */
        .packages-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .package-card {
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(155, 89, 182, 0.3);
            border-radius: 15px;
            padding: 30px 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .package-card:hover {
            transform: translateY(-5px);
            border-color: #9b59b6;
            box-shadow: 0 10px 30px rgba(155, 89, 182, 0.4);
        }

        .package-icon {
            font-size: 40px;
            margin-bottom: 15px;
        }

        .package-title {
            font-size: 20px;
            color: #9b59b6;
            margin-bottom: 10px;
        }

        .package-price {
            font-size: 32px;
            background: linear-gradient(135deg, #9b59b6, #e74c3c);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .package-features {
            font-size: 14px;
            color: #ccc;
            margin-bottom: 15px;
        }

        /* Chat Interface */
        .chat-container {
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(155, 89, 182, 0.3);
            border-radius: 15px;
            padding: 20px;
            margin: 30px 0;
            min-height: 400px;
            max-height: 600px;
            overflow-y: auto;
        }

        .chat-message {
            margin-bottom: 20px;
            animation: slideIn 0.3s;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-10px); }
            to { opacity: 1; transform: translateX(0); }
        }

        .message-user {
            background: rgba(155, 89, 182, 0.3);
            padding: 12px 16px;
            border-radius: 15px 15px 5px 15px;
            margin-left: 20%;
            text-align: right;
        }

        .message-wizard {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px 20px;
            border-radius: 15px 15px 15px 5px;
            margin-right: 20%;
        }

        .wizard-avatar {
            display: inline-block;
            margin-right: 10px;
            font-size: 24px;
        }

        .reading-text {
            display: inline-block;
            width: 90%;
            line-height: 1.8;
            white-space: pre-wrap;
        }

        .follow-up-input {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .follow-up-input input {
            flex: 1;
            padding: 12px;
            border: 2px solid rgba(155, 89, 182, 0.3);
            border-radius: 25px;
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
            font-family: 'Sarabun', sans-serif;
        }

        .follow-up-count {
            text-align: center;
            color: #9b59b6;
            margin: 15px 0;
            font-size: 16px;
        }

        /* Buttons */
        .btn {
            background: linear-gradient(135deg, #9b59b6, #8e44ad);
            color: white;
            padding: 15px 35px;
            font-size: 18px;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            font-weight: bold;
            box-shadow: 0 10px 30px rgba(155, 89, 182, 0.4);
            transition: all 0.3s;
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 40px rgba(155, 89, 182, 0.6);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn-secondary {
            background: transparent;
            border: 2px solid #9b59b6;
        }

        .btn-container {
            text-align: center;
            margin: 30px 0;
        }

        /* Card Drawing */
        .card-deck {
            display: flex;
            justify-content: center;
            gap: 10px;
            flex-wrap: wrap;
            margin: 30px 0;
        }

        .tarot-card {
            width: 100px;
            height: 160px;
            background: linear-gradient(135deg, #2d1b4e, #1a1f3a);
            border: 3px solid #9b59b6;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 50px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .tarot-card:hover {
            transform: translateY(-15px) scale(1.05);
        }

        .tarot-card.selected {
            opacity: 0.3;
        }

        @media (max-width: 768px) {
            h1 { font-size: 28px; }
            .topics-grid { grid-template-columns: 1fr; }
            .packages-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div class="magic-bg"></div>

    <div class="container">
        <header>
            <div class="logo">üîÆ</div>
            <h1>The Wizard of Destiny Tales</h1>
            <p class="tagline">‡∏ó‡∏µ‡πà‡∏ã‡∏∂‡πà‡∏á‡πÄ‡∏ß‡∏ó‡∏°‡∏ô‡∏ï‡∏£‡πå‡∏û‡∏ö‡∏Å‡∏±‡∏ö‡πÇ‡∏ä‡∏Ñ‡∏ä‡∏∞‡∏ï‡∏≤</p>
        </header>

        <div class="progress">
            <div class="progress-step active" id="step1">1</div>
            <div class="progress-step" id="step2">2</div>
            <div class="progress-step" id="step3">3</div>
            <div class="progress-step" id="step4">4</div>
            <div class="progress-step" id="step5">5</div>
        </div>

        <!-- Screen 1: Topic Selection -->
        <div class="screen active" id="topicScreen">
            <h2 style="text-align: center; margin-bottom: 20px; color: #9b59b6;">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ñ‡∏≤‡∏°</h2>
            <div class="topics-grid">
                <div class="topic-card" onclick="selectTopic('love', 'üíñ ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏±‡∏Å‡πÅ‡∏•‡∏∞‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå')">
                    <div class="topic-icon">üíñ</div>
                    <div class="topic-title">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏±‡∏Å‡πÅ‡∏•‡∏∞‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå</div>
                    <p style="color: #ccc; font-size: 14px;">‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏±‡∏Å ‡∏Ñ‡∏π‡πà‡∏Ñ‡∏£‡∏≠‡∏á ‡πÅ‡∏•‡∏∞‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå</p>
                </div>
                <div class="topic-card" onclick="selectTopic('career', 'üíº ‡∏Å‡∏≤‡∏£‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡∏∞‡∏≠‡∏≤‡∏ä‡∏µ‡∏û')">
                    <div class="topic-icon">üíº</div>
                    <div class="topic-title">‡∏Å‡∏≤‡∏£‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡∏∞‡∏≠‡∏≤‡∏ä‡∏µ‡∏û</div>
                    <p style="color: #ccc; font-size: 14px;">‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏á‡∏≤‡∏ô ‡∏≠‡∏≤‡∏ä‡∏µ‡∏û ‡πÅ‡∏•‡∏∞‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡πâ‡∏≤‡∏ß‡∏´‡∏ô‡πâ‡∏≤</p>
                </div>
                <div class="topic-card" onclick="selectTopic('money', 'üí∞ ‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô‡πÅ‡∏•‡∏∞‡∏Ñ‡∏ß‡∏≤‡∏°‡∏°‡∏±‡πà‡∏á‡∏Ñ‡∏±‡πà‡∏á')">
                    <div class="topic-icon">üí∞</div>
                    <div class="topic-title">‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô‡πÅ‡∏•‡∏∞‡∏Ñ‡∏ß‡∏≤‡∏°‡∏°‡∏±‡πà‡∏á‡∏Ñ‡∏±‡πà‡∏á</div>
                    <p style="color: #ccc; font-size: 14px;">‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡πÄ‡∏á‡∏¥‡∏ô ‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à ‡πÅ‡∏•‡∏∞‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡πà‡∏≥‡∏£‡∏ß‡∏¢</p>
                </div>
                <div class="topic-card" onclick="selectTopic('health', 'üè• ‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡πÅ‡∏•‡∏∞‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏õ‡πá‡∏ô‡∏≠‡∏¢‡∏π‡πà')">
                    <div class="topic-icon">üè•</div>
                    <div class="topic-title">‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡πÅ‡∏•‡∏∞‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏õ‡πá‡∏ô‡∏≠‡∏¢‡∏π‡πà</div>
                    <p style="color: #ccc; font-size: 14px;">‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û ‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô ‡πÅ‡∏•‡∏∞‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏°‡∏î‡∏∏‡∏•</p>
                </div>
                <div class="topic-card" onclick="selectTopic('family', 'üë®‚Äçüë©‚Äçüëß ‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏±‡∏ß‡πÅ‡∏•‡∏∞‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô')">
                    <div class="topic-icon">üë®‚Äçüë©‚Äçüëß</div>
                    <div class="topic-title">‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏±‡∏ß‡πÅ‡∏•‡∏∞‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô</div>
                    <p style="color: #ccc; font-size: 14px;">‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå‡∏Å‡∏±‡∏ö‡∏Ñ‡∏ô‡πÉ‡∏Å‡∏•‡πâ‡∏ä‡∏¥‡∏î</p>
                </div>
                <div class="topic-card" onclick="selectTopic('spiritual', 'üåü ‡∏à‡∏∏‡∏î‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå‡πÅ‡∏•‡∏∞‡∏à‡∏¥‡∏ï‡∏ß‡∏¥‡∏ç‡∏ç‡∏≤‡∏ì')">
                    <div class="topic-icon">üåü</div>
                    <div class="topic-title">‡∏à‡∏∏‡∏î‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå‡πÅ‡∏•‡∏∞‡∏à‡∏¥‡∏ï‡∏ß‡∏¥‡∏ç‡∏ç‡∏≤‡∏ì</div>
                    <p style="color: #ccc; font-size: 14px;">‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ï‡∏¥‡∏ö‡πÇ‡∏ï‡πÅ‡∏•‡∏∞‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏°‡∏≤‡∏¢‡∏Ç‡∏≠‡∏á‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï</p>
                </div>
            </div>
        </div>

        <!-- Screen 2: Question Input -->
        <div class="screen" id="questionScreen">
            <h2 style="text-align: center; margin-bottom: 20px; color: #9b59b6;">‡∏ñ‡∏≤‡∏°‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</h2>
            <div class="question-section">
                <p style="color: #c9b3d4; margin-bottom: 15px; text-align: center;">
                    <span id="selectedTopicDisplay"></span>
                </p>
                <p style="color: #f39c12; background: rgba(243, 156, 18, 0.1); border-left: 3px solid #f39c12; padding: 12px 15px; border-radius: 8px; font-size: 14px; margin-bottom: 20px; line-height: 1.6;">
                    ‚ú® <strong>‡πÄ‡∏Ñ‡∏•‡πá‡∏î‡∏•‡∏±‡∏ö‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç:</strong> ‡∏¢‡∏¥‡πà‡∏á‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô‡πÅ‡∏•‡∏∞‡∏ï‡∏£‡∏á‡∏õ‡∏£‡∏∞‡πÄ‡∏î‡πá‡∏ô‡πÄ‡∏ó‡πà‡∏≤‡πÑ‡∏´‡∏£‡πà ‡∏Ñ‡∏≥‡∏ó‡∏≥‡∏ô‡∏≤‡∏¢‡∏à‡∏≤‡∏Å‡πÑ‡∏û‡πà‡∏Å‡πá‡∏à‡∏∞‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥‡πÅ‡∏•‡∏∞‡∏ï‡∏≠‡∏ö‡πÇ‡∏à‡∏ó‡∏¢‡πå‡∏°‡∏≤‡∏Å‡∏Ç‡∏∂‡πâ‡∏ô‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô ‡∏û‡πà‡∏≠‡∏°‡∏î‡∏à‡∏∞‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏°‡∏≠‡∏á‡πÄ‡∏´‡πá‡∏ô‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á‡πÅ‡∏•‡∏∞‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏Å‡∏±‡∏ö‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏î‡πâ‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô‡∏¢‡∏¥‡πà‡∏á‡∏Ç‡∏∂‡πâ‡∏ô üîÆ
                </p>
                <textarea class="question-input" id="questionInput" rows="3" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà..."></textarea>
                <p style="color: #aaa; font-size: 14px; margin-bottom: 15px;">üí° ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°:</p>
                <div class="suggestions" id="suggestions"></div>

                <!-- Personalization Section -->
                <div style="margin-top: 30px; padding-top: 25px; border-top: 1px solid rgba(155, 89, 182, 0.3);">
                    <p style="color: #9b59b6; font-size: 16px; margin-bottom: 20px; text-align: center;">
                        ‚ú® ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏Ñ‡∏≥‡∏ó‡∏≥‡∏ô‡∏≤‡∏¢‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏Å‡∏±‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏°‡∏≤‡∏Å‡∏Ç‡∏∂‡πâ‡∏ô (‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö)
                    </p>

                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 15px;">
                        <div>
                            <label style="color: #c9b3d4; font-size: 14px; display: block; margin-bottom: 8px;">üë§ ‡∏ä‡πà‡∏ß‡∏á‡∏≠‡∏≤‡∏¢‡∏∏</label>
                            <select id="ageRange" class="question-input" style="padding: 10px; margin: 0;">
                                <option value="">‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏</option>
                                <option value="18-25">18-25 ‡∏õ‡∏µ</option>
                                <option value="26-35">26-35 ‡∏õ‡∏µ</option>
                                <option value="36-45">36-45 ‡∏õ‡∏µ</option>
                                <option value="46-55">46-55 ‡∏õ‡∏µ</option>
                                <option value="56+">56+ ‡∏õ‡∏µ</option>
                            </select>
                        </div>

                        <div>
                            <label style="color: #c9b3d4; font-size: 14px; display: block; margin-bottom: 8px;">‚ößÔ∏è ‡πÄ‡∏û‡∏®</label>
                            <select id="gender" class="question-input" style="padding: 10px; margin: 0;">
                                <option value="">‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏</option>
                                <option value="male">‡∏ä‡∏≤‡∏¢</option>
                                <option value="female">‡∏´‡∏ç‡∏¥‡∏á</option>
                                <option value="other">‡∏≠‡∏∑‡πà‡∏ô‡πÜ</option>
                            </select>
                        </div>
                    </div>

                    <div>
                        <label style="color: #c9b3d4; font-size: 14px; display: block; margin-bottom: 8px;">üí≠ ‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ‡∏Ñ‡∏∏‡∏ì‡∏£‡∏π‡πâ‡∏™‡∏∂‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÑ‡∏£?</label>
                        <select id="emotionalState" class="question-input" style="padding: 10px; margin: 0;">
                            <option value="">‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏</option>
                            <option value="hopeful">‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏ß‡∏±‡∏á ‚ú®</option>
                            <option value="worried">‡∏Å‡∏±‡∏á‡∏ß‡∏• üòü</option>
                            <option value="confused">‡∏™‡∏±‡∏ö‡∏™‡∏ô ü§î</option>
                            <option value="happy">‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∏‡∏Ç üòä</option>
                            <option value="sad">‡πÄ‡∏®‡∏£‡πâ‡∏≤ üò¢</option>
                        </select>
                    </div>
                </div>
            </div>
            <div class="btn-container">
                <button class="btn btn-secondary" onclick="goBack('topicScreen')">‚Üê ‡∏Å‡∏•‡∏±‡∏ö</button>
                <button class="btn" onclick="goToPackages()">‡∏ñ‡∏±‡∏î‡πÑ‡∏õ ‚Üí</button>
            </div>
        </div>

        <!-- Screen 3: Package Selection -->
        <div class="screen" id="packageScreen">
            <h2 style="text-align: center; margin-bottom: 20px; color: #9b59b6;">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏û‡πá‡∏Ñ‡πÄ‡∏Å‡∏à‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</h2>
            <div class="packages-grid">
                <div class="package-card" onclick="selectPackage('quick', 199, 1, 1)">
                    <div class="package-icon">‚ú®</div>
                    <div class="package-title">‡πÑ‡∏û‡πà‡∏î‡∏ß‡∏á‡∏ä‡∏∞‡∏ï‡∏≤</div>
                    <div class="package-price">‡∏ø199</div>
                    <div class="package-features">
                        ‚Ä¢ ‡πÑ‡∏û‡πà 1 ‡πÉ‡∏ö<br>
                        ‚Ä¢ ‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏° 1 ‡∏Ç‡πâ‡∏≠<br>
                        ‚Ä¢ ‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏£‡∏ß‡∏î‡πÄ‡∏£‡πá‡∏ß‡πÅ‡∏•‡∏∞‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô
                    </div>
                </div>
                <div class="package-card" onclick="selectPackage('deep', 399, 3, 2)">
                    <div class="package-icon">üåü</div>
                    <div class="package-title">‡∏Å‡∏≤‡∏£‡∏≠‡πà‡∏≤‡∏ô‡∏•‡∏∂‡∏Å‡∏ã‡∏∂‡πâ‡∏á</div>
                    <div class="package-price">‡∏ø399</div>
                    <div class="package-features">
                        ‚Ä¢ ‡πÑ‡∏û‡πà 3 ‡πÉ‡∏ö (‡∏≠‡∏î‡∏µ‡∏ï-‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô-‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï)<br>
                        ‚Ä¢ ‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏° 2 ‡∏Ç‡πâ‡∏≠<br>
                        ‚Ä¢ ‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÄ‡∏ä‡∏¥‡∏á‡∏•‡∏∂‡∏Å
                    </div>
                </div>
                <div class="package-card" onclick="selectPackage('complete', 799, 10, 3)">
                    <div class="package-icon">‚ö°</div>
                    <div class="package-title">‡∏ß‡∏¥‡∏™‡∏±‡∏¢‡∏ó‡∏±‡∏®‡∏ô‡πå‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå</div>
                    <div class="package-price">‡∏ø799</div>
                    <div class="package-features">
                        ‚Ä¢ ‡πÑ‡∏û‡πà 10 ‡πÉ‡∏ö (Celtic Cross)<br>
                        ‚Ä¢ ‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏° 3 ‡∏Ç‡πâ‡∏≠<br>
                        ‚Ä¢ ‡∏Å‡∏≤‡∏£‡∏≠‡πà‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå‡πÅ‡∏ö‡∏ö
                    </div>
                </div>
            </div>
            <div class="btn-container">
                <button class="btn btn-secondary" onclick="goBack('questionScreen')">‚Üê ‡∏Å‡∏•‡∏±‡∏ö</button>
            </div>
        </div>

        <!-- Screen 4: Card Drawing -->
        <div class="screen" id="cardScreen">
            <h2 style="text-align: center; margin-bottom: 20px; color: #9b59b6;">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏û‡πà‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</h2>
            <p style="text-align: center; color: #c9b3d4; margin-bottom: 20px;">
                ‡∏à‡∏±‡∏ö‡∏™‡∏±‡πà‡∏ô‡πÑ‡∏û‡πà‡πÅ‡∏•‡∏∞‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÉ‡∏ö‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏´‡∏≤‡∏Ñ‡∏∏‡∏ì...
            </p>
            <div class="btn-container">
                <button class="btn btn-secondary" onclick="shuffleCards()">üîÄ ‡∏™‡∏±‡∏ö‡πÑ‡∏û‡πà</button>
            </div>
            <div class="card-deck" id="cardDeck"></div>
            <p style="text-align: center; color: #ddd; margin: 20px 0;">
                ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß: <span id="selectedCount">0</span> / <span id="totalNeeded">1</span>
            </p>
            <div class="btn-container">
                <button class="btn" id="revealBtn" onclick="revealReading()" disabled>‚ú® ‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏ú‡∏¢‡∏Ñ‡∏≥‡∏ó‡∏≥‡∏ô‡∏≤‡∏¢</button>
            </div>
        </div>

        <!-- Screen 5: Reading & Chat -->
        <div class="screen" id="chatScreen">
            <h2 style="text-align: center; margin-bottom: 20px; color: #9b59b6;">‡∏ô‡∏¥‡∏ó‡∏≤‡∏ô‡∏î‡∏ß‡∏á‡∏ä‡∏∞‡∏ï‡∏≤‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</h2>
            <div class="chat-container" id="chatMessages"></div>

            <p style="color: #f39c12; background: rgba(243, 156, 18, 0.1); border-left: 3px solid #f39c12; padding: 12px 15px; border-radius: 8px; font-size: 14px; margin: 20px 0; line-height: 1.6;">
                üí¨ <strong>‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏Ñ‡∏∑‡∏≠‡∏≠‡∏∞‡πÑ‡∏£?</strong><br>
                ‡πÉ‡∏ä‡πâ‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ç‡∏≠‡∏Ñ‡∏≥‡∏ä‡∏µ‡πâ‡πÅ‡∏à‡∏á‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏à‡∏≤‡∏∞‡∏•‡∏∂‡∏Å‡πÉ‡∏ô‡∏õ‡∏£‡∏∞‡πÄ‡∏î‡πá‡∏ô‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô‡∏à‡∏≤‡∏Å‡πÑ‡∏û‡πà‡∏ä‡∏∏‡∏î‡πÄ‡∏î‡∏¥‡∏°‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡∏¥‡∏î‡πÑ‡∏ß‡πâ‡πÅ‡∏•‡πâ‡∏ß ‡∏û‡πà‡∏≠‡∏°‡∏î‡∏à‡∏∞‡∏ï‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÑ‡∏û‡πà‡πÄ‡∏´‡∏•‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô‡πÉ‡∏ô‡∏°‡∏∏‡∏°‡∏°‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏•‡∏∂‡∏Å‡∏ã‡∏∂‡πâ‡∏á‡∏¢‡∏¥‡πà‡∏á‡∏Ç‡∏∂‡πâ‡∏ô
            </p>

            <div class="follow-up-count" id="followUpCount">‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡πÄ‡∏´‡∏•‡∏∑‡∏≠: 1</div>
            <div class="follow-up-input">
                <input type="text" id="followUpInput" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°...">
                <button class="btn" onclick="askFollowUp()">‡∏™‡πà‡∏á</button>
            </div>
            <div class="btn-container" style="margin-top: 30px;">
                <button class="btn btn-secondary" onclick="startOver()">üîÑ ‡∏î‡∏π‡∏î‡∏ß‡∏á‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á</button>
                <button class="btn" onclick="downloadReading()">üìÑ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏≠‡πà‡∏≤‡∏ô</button>
            </div>
        </div>
    </div>

    <script>
        let currentScreen = 'topicScreen';
        let selectedTopic = '';
        let selectedTopicName = '';
        let userQuestion = '';
        let selectedPackage = {};
        let followUpCount = 0;
        let selectedCards = [];
        let conversationHistory = [];
        let userProfile = {
            ageRange: '',
            gender: '',
            emotionalState: ''
        };

        const suggestions = {
            love: [
                '‡∏â‡∏±‡∏ô‡∏à‡∏∞‡πÄ‡∏à‡∏≠‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πà‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÑ‡∏´‡∏£‡πà',
                '‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÑ‡∏£',
                '‡∏à‡∏∞‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏±‡∏Å‡πÉ‡∏´‡∏°‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤‡πÉ‡∏ô‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï‡∏â‡∏±‡∏ô‡πÑ‡∏´‡∏°',
                '‡∏â‡∏±‡∏ô‡∏Ñ‡∏ß‡∏£‡∏¢‡∏±‡∏á‡∏Ñ‡∏á‡∏≠‡∏¢‡∏π‡πà‡∏´‡∏£‡∏∑‡∏≠‡∏Ñ‡∏ß‡∏£‡∏à‡∏≤‡∏Å‡πÑ‡∏õ'
            ],
            career: [
                '‡∏Ñ‡∏ß‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏á‡∏≤‡∏ô‡πÑ‡∏´‡∏°',
                '‡∏Å‡∏≤‡∏£‡∏á‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô‡∏à‡∏∞‡∏Å‡πâ‡∏≤‡∏ß‡∏´‡∏ô‡πâ‡∏≤‡πÑ‡∏´‡∏°',
                '‡πÇ‡∏≠‡∏Å‡∏≤‡∏™‡πÉ‡∏´‡∏°‡πà‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏°‡∏≤‡∏´‡∏≤‡∏â‡∏±‡∏ô‡πÑ‡∏´‡∏°',
                '‡∏≠‡∏≤‡∏ä‡∏µ‡∏û‡πÑ‡∏´‡∏ô‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏Å‡∏±‡∏ö‡∏â‡∏±‡∏ô'
            ],
            money: [
                '‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô‡∏à‡∏∞‡∏î‡∏µ‡∏Ç‡∏∂‡πâ‡∏ô‡πÑ‡∏´‡∏°',
                '‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡πÑ‡∏´‡∏°',
                '‡∏Ñ‡∏ß‡∏£‡∏•‡∏á‡∏ó‡∏∏‡∏ô‡πÉ‡∏ô‡πÇ‡∏≠‡∏Å‡∏≤‡∏™‡∏ô‡∏µ‡πâ‡πÑ‡∏´‡∏°',
                '‡∏à‡∏∞‡∏°‡∏µ‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤‡∏´‡∏≤‡∏â‡∏±‡∏ô‡πÑ‡∏´‡∏°'
            ],
            health: [
                '‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÑ‡∏£',
                '‡∏≠‡∏∞‡πÑ‡∏£‡∏à‡∏∞‡∏ä‡πà‡∏ß‡∏¢‡πÉ‡∏´‡πâ‡∏â‡∏±‡∏ô‡∏°‡∏µ‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô‡∏î‡∏µ‡∏Ç‡∏∂‡πâ‡∏ô',
                '‡∏Ñ‡∏ß‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ß‡∏¥‡∏ñ‡∏µ‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÑ‡∏£',
                '‡∏à‡∏∞‡∏ü‡∏∑‡πâ‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏£‡πá‡∏ß‡πÑ‡∏´‡∏°'
            ],
            family: [
                '‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå‡πÉ‡∏ô‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏±‡∏ß‡∏à‡∏∞‡∏î‡∏µ‡∏Ç‡∏∂‡πâ‡∏ô‡πÑ‡∏´‡∏°',
                '‡∏à‡∏∞‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏Å‡∏±‡∏ö‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏±‡∏ß‡πÑ‡∏î‡πâ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÑ‡∏£',
                '‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏±‡∏ß‡∏à‡∏∞‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏â‡∏±‡∏ô‡πÑ‡∏´‡∏°',
                '‡∏°‡∏¥‡∏ï‡∏£‡∏†‡∏≤‡∏û‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡∏¢‡∏±‡πà‡∏á‡∏¢‡∏∑‡∏ô‡πÑ‡∏´‡∏°'
            ],
            spiritual: [
                '‡∏à‡∏∏‡∏î‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå‡∏Ç‡∏≠‡∏á‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï‡∏â‡∏±‡∏ô‡∏Ñ‡∏∑‡∏≠‡∏≠‡∏∞‡πÑ‡∏£',
                '‡∏â‡∏±‡∏ô‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏î‡∏¥‡∏ô‡∏ö‡∏ô‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏´‡∏°',
                '‡∏≠‡∏∞‡πÑ‡∏£‡∏à‡∏∞‡∏ô‡∏≥‡∏û‡∏≤‡∏â‡∏±‡∏ô‡πÑ‡∏õ‡∏™‡∏π‡πà‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∏‡∏Ç',
                '‡∏à‡∏∞‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏à‡∏¥‡∏ï‡∏ß‡∏¥‡∏ç‡∏ç‡∏≤‡∏ì‡πÑ‡∏î‡πâ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÑ‡∏£'
            ]
        };

        function selectTopic(topic, name) {
            selectedTopic = topic;
            selectedTopicName = name;
            document.getElementById('selectedTopicDisplay').textContent = name;

            const suggestionsDiv = document.getElementById('suggestions');
            suggestionsDiv.innerHTML = '';
            suggestions[topic].forEach(s => {
                const btn = document.createElement('button');
                btn.className = 'suggestion-btn';
                btn.textContent = s;
                btn.onclick = () => {
                    document.getElementById('questionInput').value = s;
                };
                suggestionsDiv.appendChild(btn);
            });

            goToScreen('questionScreen');
            updateProgress(2);
        }

        function goToPackages() {
            userQuestion = document.getElementById('questionInput').value;
            if (!userQuestion.trim()) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì');
                return;
            }

            // Capture personalization data
            userProfile.ageRange = document.getElementById('ageRange').value;
            userProfile.gender = document.getElementById('gender').value;
            userProfile.emotionalState = document.getElementById('emotionalState').value;

            goToScreen('packageScreen');
            updateProgress(3);
        }

        function selectPackage(type, price, cards, followUps) {
            selectedPackage = { type, price, cards, followUps };
            followUpCount = followUps;

            goToScreen('cardScreen');
            updateProgress(4);
            initializeCards(cards);
        }

        function initializeCards(count) {
            const deck = document.getElementById('cardDeck');
            deck.innerHTML = '';
            document.getElementById('totalNeeded').textContent = count;
            selectedCards = [];

            for (let i = 0; i < 10; i++) {
                const card = document.createElement('div');
                card.className = 'tarot-card';
                card.innerHTML = 'üÇ†';
                card.onclick = () => selectCard(i, count);
                deck.appendChild(card);
            }
        }

        function shuffleCards() {
            const cards = document.querySelectorAll('.tarot-card');
            cards.forEach(card => {
                card.style.transform = 'rotateY(180deg)';
                setTimeout(() => card.style.transform = '', 600);
            });
        }

        function selectCard(index, needed) {
            if (selectedCards.length >= needed) return;

            const cards = document.querySelectorAll('.tarot-card');
            const card = cards[index];
            if (card.classList.contains('selected')) return;

            card.classList.add('selected');
            selectedCards.push(index);

            document.getElementById('selectedCount').textContent = selectedCards.length;

            if (selectedCards.length === needed) {
                document.getElementById('revealBtn').disabled = false;
            }
        }

        async function revealReading() {
            goToScreen('chatScreen');
            updateProgress(5);

            conversationHistory = [];

            // Show loading message
            addWizardMessage('üîÆ ‡∏û‡πà‡∏≠‡∏°‡∏î‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡∏≤‡∏ô‡∏î‡∏ß‡∏á‡πÅ‡∏•‡∏∞‡πÄ‡∏õ‡∏¥‡∏î‡πÑ‡∏û‡πà‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì...<br><em style="color: #c9b3d4;">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà ‚ú®</em>');

            // Call API for initial reading
            try {
                const reading = await generateReading(selectedTopic, userQuestion, selectedPackage.type, false);

                // Remove loading message
                const chatDiv = document.getElementById('chatMessages');
                chatDiv.innerHTML = '';

                // Add actual reading
                addWizardMessage(reading);
            } catch (error) {
                console.error('Error generating reading:', error);
                const chatDiv = document.getElementById('chatMessages');
                chatDiv.innerHTML = '';
                addWizardMessage('üòî ‡∏Ç‡∏≠‡∏≠‡∏†‡∏±‡∏¢ ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡πà‡∏≤‡∏ô‡πÑ‡∏û‡πà ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á');
            }

            document.getElementById('followUpCount').textContent = `‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡πÄ‡∏´‡∏•‡∏∑‡∏≠: ${followUpCount}`;
        }

        async function generateReading(topic, question, packageType, isFollowUp = false) {
            try {
                const response = await fetch('/api/tarot-reading', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        topic: selectedTopic,
                        topicName: selectedTopicName,
                        question: question,
                        packageType: packageType,
                        cardCount: selectedPackage.cards,
                        userProfile: userProfile,
                        isFollowUp: isFollowUp,
                        conversationHistory: conversationHistory
                    })
                });

                if (!response.ok) {
                    throw new Error(`API error: ${response.status}`);
                }

                const data = await response.json();
                return data.reading;
            } catch (error) {
                console.error('Error calling API:', error);
                throw error;
            }
        }

        function addWizardMessage(text) {
            const chatDiv = document.getElementById('chatMessages');
            const msg = document.createElement('div');
            msg.className = 'chat-message';

            // Format the text with proper line breaks
            const formattedText = text
                .replace(/\n\n/g, '<br><br>')  // Double line breaks
                .replace(/\n/g, '<br>');         // Single line breaks

            msg.innerHTML = `
                <div class="message-wizard">
                    <span class="wizard-avatar">üßô‚Äç‚ôÇÔ∏è</span>
                    <div class="reading-text">${formattedText}</div>
                </div>
            `;
            chatDiv.appendChild(msg);
            chatDiv.scrollTop = chatDiv.scrollHeight;

            conversationHistory.push({ role: 'wizard', text });
        }

        function addUserMessage(text) {
            const chatDiv = document.getElementById('chatMessages');
            const msg = document.createElement('div');
            msg.className = 'chat-message';
            msg.innerHTML = `<div class="message-user">${text}</div>`;
            chatDiv.appendChild(msg);
            chatDiv.scrollTop = chatDiv.scrollHeight;

            conversationHistory.push({ role: 'user', text });
        }

        async function askFollowUp() {
            if (followUpCount <= 0) {
                alert('‡∏Ñ‡∏∏‡∏ì‡πÉ‡∏ä‡πâ‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏´‡∏°‡∏î‡πÅ‡∏•‡πâ‡∏ß üòä\n\n‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ã‡∏∑‡πâ‡∏≠‡πÅ‡∏û‡πá‡∏Ñ‡πÄ‡∏Å‡∏à‡πÉ‡∏´‡∏°‡πà‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ñ‡∏≤‡∏°‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÑ‡∏î‡πâ‡∏ô‡∏∞‡∏Ñ‡∏∞!');
                return;
            }

            const input = document.getElementById('followUpInput');
            const question = input.value.trim();

            if (!question) return;

            addUserMessage(question);
            input.value = '';

            followUpCount--;
            document.getElementById('followUpCount').textContent = `‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡πÄ‡∏´‡∏•‡∏∑‡∏≠: ${followUpCount}`;

            // Show loading
            addWizardMessage('üí´ ‡∏û‡πà‡∏≠‡∏°‡∏î‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏°‡∏≠‡∏á‡∏•‡∏∂‡∏Å‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏õ‡πÉ‡∏ô‡πÑ‡∏û‡πà...');

            try {
                const response = await generateReading(selectedTopic, question, selectedPackage.type, true);

                // Remove loading message
                const messages = document.querySelectorAll('.chat-message');
                messages[messages.length - 1].remove();

                // Add real response
                addWizardMessage(response);

                if (followUpCount === 0) {
                    setTimeout(() => {
                        addWizardMessage(`
                            ‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏î‡πâ‡πÉ‡∏ä‡πâ‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏Ñ‡∏£‡∏ö‡πÅ‡∏•‡πâ‡∏ß! üåü

                            ‡∏´‡∏≤‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏à‡∏≤‡∏∞‡∏•‡∏∂‡∏Å‡∏°‡∏≤‡∏Å‡∏Ç‡∏∂‡πâ‡∏ô ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ:
                            ‚Ä¢ ‡∏ã‡∏∑‡πâ‡∏≠‡πÅ‡∏û‡πá‡∏Ñ‡πÄ‡∏Å‡∏à‡πÉ‡∏´‡∏°‡πà ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ñ‡∏≤‡∏°‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡πÉ‡∏´‡∏°‡πà
                            ‚Ä¢ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏≠‡πà‡∏≤‡∏ô‡∏ô‡∏µ‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á‡πÉ‡∏ô‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï

                            ‡∏Ç‡∏≠‡πÉ‡∏´‡πâ‡πÇ‡∏ä‡∏Ñ‡∏î‡∏µ‡πÉ‡∏ô‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì! üí´‚ú®
                        `);
                        document.getElementById('followUpInput').disabled = true;
                    }, 1500);
                }
            } catch (error) {
                console.error('Error generating follow-up:', error);
                const messages = document.querySelectorAll('.chat-message');
                messages[messages.length - 1].remove();
                addWizardMessage('üòî ‡∏Ç‡∏≠‡∏≠‡∏†‡∏±‡∏¢ ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á');
                followUpCount++; // Restore the count since it failed
                document.getElementById('followUpCount').textContent = `‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡πÄ‡∏´‡∏•‡∏∑‡∏≠: ${followUpCount}`;
            }
        }

        function downloadReading() {
            alert('üìÑ ‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å PDF ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏û‡∏±‡∏í‡∏ô‡∏≤!\n\n‡πÉ‡∏ô‡πÄ‡∏£‡πá‡∏ß‡πÜ ‡∏ô‡∏µ‡πâ‡∏Ñ‡∏∏‡∏ì‡∏à‡∏∞‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ:\n‚Ä¢ ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡∏Å‡∏≤‡∏£‡∏≠‡πà‡∏≤‡∏ô‡πÄ‡∏õ‡πá‡∏ô PDF\n‚Ä¢ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•\n‚Ä¢ ‡πÅ‡∏ä‡∏£‡πå‡∏ú‡πà‡∏≤‡∏ô Line/Facebook');
        }

        function startOver() {
            goToScreen('topicScreen');
            updateProgress(1);
            selectedCards = [];
            conversationHistory = [];
            document.getElementById('questionInput').value = '';
            document.getElementById('followUpInput').disabled = false;
        }

        function goToScreen(screenId) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(screenId).classList.add('active');
            currentScreen = screenId;
            window.scrollTo(0, 0);
        }

        function goBack(screenId) {
            goToScreen(screenId);
            const stepMap = {
                'topicScreen': 1,
                'questionScreen': 2,
                'packageScreen': 3,
                'cardScreen': 4
            };
            updateProgress(stepMap[screenId]);
        }

        function updateProgress(step) {
            for (let i = 1; i <= 5; i++) {
                const stepEl = document.getElementById(`step${i}`);
                if (i <= step) {
                    stepEl.classList.add('active');
                } else {
                    stepEl.classList.remove('active');
                }
            }
        }
    </script>
</body>
</html>